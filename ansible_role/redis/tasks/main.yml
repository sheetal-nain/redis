    - name: Update apt package index
      apt:
        update_cache: yes

    - name: Install Redis server and dependencies
      apt:
        name:
          - redis-server
          - build-essential
          - tcl
        state: present

    - name: Install Python 3 pip
      apt:
        name: python3-pip
        state: present

    - name: Install Python Redis client
      pip:
        name: redis
        state: present
        executable: pip3

    - name: Ensure Redis service is enabled and started
      systemd:
        name: redis-server
        enabled: yes
        state: started

    - name: Configure Redis to run as a background service
      lineinfile:
        path: /etc/redis/redis.conf
        regexp: '^#daemonize no'
        line: 'daemonize yes'
        backup: yes

    - name: Test Redis is running (ping)
      command: redis-cli ping
      register: redis_ping
      failed_when: redis_ping.stdout != 'PONG'
      changed_when: false

    - name: Show Redis ping response
      debug:
        msg: "Redis responded with: {{ redis_ping.stdout }}"
